map $http_upgrade $connection_upgrade {
  default upgrade;
  ''      close;
}

server {
  listen 80;

  # Keep uploads reasonable in dev
  client_max_body_size 16m;

  # Simple health check
  location = /healthz {
    access_log off;
    add_header Content-Type text/plain;
    return 200 "ok\n";
  }

  # App proxy
  location / {
    proxy_pass         http://api:5000;
    proxy_http_version 1.1;

    # Standard headers
    proxy_set_header   Host               $host;
    proxy_set_header   X-Real-IP          $remote_addr;
    proxy_set_header   X-Forwarded-For    $proxy_add_x_forwarded_for;
    proxy_set_header   X-Forwarded-Proto  $scheme;

    # WebSocket / SSE friendly
    proxy_set_header   Upgrade            $http_upgrade;
    proxy_set_header   Connection         $connection_upgrade;

    # Reasonable timeouts for dev (donâ€™t block workers forever)
    proxy_read_timeout 60s;
    proxy_send_timeout 60s;
  }


}
